import { FinancialRow, PeriodNode, SubsidiaryNode } from "./types";

export const MOCK_DATA: FinancialRow[] = [
  // Revenue section
  {
    financialRow: "Revenue",
    q1_2024: 2513.64,
    q2_2024: 2889.63,
    q3_2024: 3123.45,
    q4_2024: 3456.78,
    q1_2023: 2234.56,
    q2_2023: 2456.78,
    dollarDifference: 375.99,
    differencePercent: 15.0,
    group: "revenue",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Bazaar GOV",
    q1_2024: 18150.0,
    q2_2024: 20890.0,
    q3_2024: 22340.0,
    q4_2024: 25120.0,
    q1_2023: 16230.0,
    q2_2023: 17890.0,
    dollarDifference: 2740.0,
    differencePercent: 15.1,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Consumer fees",
    q1_2024: 2513.64,
    q2_2024: 2889.63,
    q3_2024: 3123.45,
    q4_2024: 3456.78,
    q1_2023: 2234.56,
    q2_2023: 2456.78,
    dollarDifference: 375.99,
    differencePercent: 15.0,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Merchant fees",
    q1_2024: 1890.45,
    q2_2024: 2145.32,
    q3_2024: 2312.34,
    q4_2024: 2567.89,
    q1_2023: 1678.9,
    q2_2023: 1845.67,
    dollarDifference: 254.87,
    differencePercent: 13.5,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Other revenue",
    q1_2024: 128.75,
    q2_2024: 145.23,
    q3_2024: 156.78,
    q4_2024: 178.9,
    q1_2023: 112.34,
    q2_2023: 123.45,
    dollarDifference: 16.48,
    differencePercent: 12.8,
    group: "revenue",
    level: 1,
  },
  // Cost of revenue section
  {
    financialRow: "Cost of revenue",
    q1_2024: 1089.23,
    q2_2024: 1245.67,
    q3_2024: 1345.89,
    q4_2024: 1456.78,
    q1_2023: 967.89,
    q2_2023: 1089.12,
    dollarDifference: 156.44,
    differencePercent: 14.4,
    group: "costs",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Delivery and fulfillment",
    q1_2024: 875.42,
    q2_2024: 998.56,
    q3_2024: 1089.23,
    q4_2024: 1189.45,
    q1_2023: 778.9,
    q2_2023: 889.12,
    dollarDifference: 123.14,
    differencePercent: 14.1,
    group: "costs",
    level: 1,
  },
  {
    financialRow: "Driver payments",
    q1_2024: 567.89,
    q2_2024: 645.67,
    q3_2024: 723.45,
    q4_2024: 789.12,
    q1_2023: 512.34,
    q2_2023: 578.9,
    dollarDifference: 77.78,
    differencePercent: 13.7,
    group: "costs",
    level: 2,
  },
  {
    financialRow: "Logistics infrastructure",
    q1_2024: 234.56,
    q2_2024: 267.89,
    q3_2024: 289.12,
    q4_2024: 312.34,
    q1_2023: 198.76,
    q2_2023: 223.45,
    dollarDifference: 33.33,
    differencePercent: 14.2,
    group: "costs",
    level: 2,
  },
  {
    financialRow: "Warehousing",
    q1_2024: 72.97,
    q2_2024: 85.0,
    q3_2024: 76.66,
    q4_2024: 87.99,
    q1_2023: 67.8,
    q2_2023: 86.77,
    dollarDifference: 12.03,
    differencePercent: 16.5,
    group: "costs",
    level: 2,
  },
  {
    financialRow: "Payment processing",
    q1_2024: 123.89,
    q2_2024: 141.23,
    q3_2024: 156.78,
    q4_2024: 167.89,
    q1_2023: 112.34,
    q2_2023: 123.45,
    dollarDifference: 17.34,
    differencePercent: 14.0,
    group: "costs",
    level: 1,
  },
  {
    financialRow: "Other cost of revenue",
    q1_2024: 89.92,
    q2_2024: 105.88,
    q3_2024: 99.88,
    q4_2024: 99.44,
    q1_2023: 76.65,
    q2_2023: 76.55,
    dollarDifference: 15.96,
    differencePercent: 17.8,
    group: "costs",
    level: 1,
  },
  // Gross profit
  {
    financialRow: "Gross profit",
    q1_2024: 1424.41,
    q2_2024: 1643.96,
    q3_2024: 1777.56,
    q4_2024: 2000.0,
    q1_2023: 1266.67,
    q2_2023: 1367.66,
    dollarDifference: 219.55,
    differencePercent: 15.4,
    group: "profit",
    level: 0,
    expanded: true,
  },
  // Operating expenses section
  {
    financialRow: "Operating expenses",
    q1_2024: 1867.89,
    q2_2024: 2134.56,
    q3_2024: 2234.67,
    q4_2024: 2456.78,
    q1_2023: 1678.9,
    q2_2023: 1845.67,
    dollarDifference: 266.67,
    differencePercent: 14.3,
    group: "expenses",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Sales and marketing",
    q1_2024: 789.45,
    q2_2024: 912.34,
    q3_2024: 998.56,
    q4_2024: 1056.78,
    q1_2023: 678.9,
    q2_2023: 745.67,
    dollarDifference: 122.89,
    differencePercent: 15.6,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Advertising and promotion",
    q1_2024: 456.78,
    q2_2024: 523.45,
    q3_2024: 589.12,
    q4_2024: 623.45,
    q1_2023: 398.76,
    q2_2023: 445.67,
    dollarDifference: 66.67,
    differencePercent: 14.6,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Sales personnel",
    q1_2024: 198.67,
    q2_2024: 223.45,
    q3_2024: 245.67,
    q4_2024: 267.89,
    q1_2023: 178.9,
    q2_2023: 198.76,
    dollarDifference: 24.78,
    differencePercent: 12.5,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Marketing operations",
    q1_2024: 134.0,
    q2_2024: 165.44,
    q3_2024: 163.77,
    q4_2024: 165.44,
    q1_2023: 101.24,
    q2_2023: 101.24,
    dollarDifference: 31.44,
    differencePercent: 23.5,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Product development",
    q1_2024: 456.78,
    q2_2024: 523.45,
    q3_2024: 589.12,
    q4_2024: 623.45,
    q1_2023: 398.76,
    q2_2023: 445.67,
    dollarDifference: 66.67,
    differencePercent: 14.6,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Research and development",
    q1_2024: 298.56,
    q2_2024: 334.78,
    q3_2024: 367.89,
    q4_2024: 389.12,
    q1_2023: 267.89,
    q2_2023: 298.56,
    dollarDifference: 36.22,
    differencePercent: 12.1,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Engineering",
    q1_2024: 158.22,
    q2_2024: 188.67,
    q3_2024: 221.23,
    q4_2024: 234.33,
    q1_2023: 130.87,
    q2_2023: 147.11,
    dollarDifference: 30.45,
    differencePercent: 19.2,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "General and administrative",
    q1_2024: 345.67,
    q2_2024: 389.23,
    q3_2024: 412.45,
    q4_2024: 445.67,
    q1_2023: 298.76,
    q2_2023: 334.56,
    dollarDifference: 43.56,
    differencePercent: 12.6,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Executive compensation",
    q1_2024: 123.45,
    q2_2024: 145.67,
    q3_2024: 156.78,
    q4_2024: 167.89,
    q1_2023: 112.34,
    q2_2023: 123.45,
    dollarDifference: 22.22,
    differencePercent: 18.0,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Legal and compliance",
    q1_2024: 98.76,
    q2_2024: 112.34,
    q3_2024: 123.45,
    q4_2024: 134.56,
    q1_2023: 89.12,
    q2_2023: 98.76,
    dollarDifference: 13.58,
    differencePercent: 13.7,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Corporate services",
    q1_2024: 123.46,
    q2_2024: 131.22,
    q3_2024: 132.22,
    q4_2024: 143.22,
    q1_2023: 97.3,
    q2_2023: 112.35,
    dollarDifference: 7.76,
    differencePercent: 6.3,
    group: "expenses",
    level: 2,
  },
  {
    financialRow: "Depreciation and amortization",
    q1_2024: 276.99,
    q2_2024: 309.54,
    q3_2024: 312.45,
    q4_2024: 334.56,
    q1_2023: 245.67,
    q2_2023: 267.89,
    dollarDifference: 32.55,
    differencePercent: 11.7,
    group: "expenses",
    level: 1,
  },
  // Operating loss
  {
    financialRow: "Operating loss",
    q1_2024: -443.48,
    q2_2024: -490.6,
    q3_2024: -457.11,
    q4_2024: -456.78,
    q1_2023: -412.23,
    q2_2023: -477.89,
    dollarDifference: -47.12,
    differencePercent: 10.6,
    group: "profit",
    level: 0,
    expanded: true,
  },
  // Other income/expense
  {
    financialRow: "Other income (expense), net",
    q1_2024: 45.67,
    q2_2024: 52.34,
    q3_2024: 56.78,
    q4_2024: 61.23,
    q1_2023: 41.23,
    q2_2023: 48.45,
    dollarDifference: 6.67,
    differencePercent: 14.6,
    group: "other",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Interest income",
    q1_2024: 34.56,
    q2_2024: 39.87,
    q3_2024: 42.34,
    q4_2024: 45.67,
    q1_2023: 31.23,
    q2_2023: 36.45,
    dollarDifference: 5.31,
    differencePercent: 15.4,
    group: "other",
    level: 1,
  },
  {
    financialRow: "Interest expense",
    q1_2024: -12.34,
    q2_2024: -14.56,
    q3_2024: -15.78,
    q4_2024: -17.89,
    q1_2023: -11.23,
    q2_2023: -12.45,
    dollarDifference: -2.22,
    differencePercent: 18.0,
    group: "other",
    level: 1,
  },
  {
    financialRow: "Other, net",
    q1_2024: 23.45,
    q2_2024: 27.03,
    q3_2024: 30.22,
    q4_2024: 33.45,
    q1_2023: 21.23,
    q2_2023: 24.45,
    dollarDifference: 3.58,
    differencePercent: 15.3,
    group: "other",
    level: 1,
  },
  // Net loss
  {
    financialRow: "Net loss",
    q1_2024: -397.81,
    q2_2024: -438.26,
    q3_2024: -400.33,
    q4_2024: -395.55,
    q1_2023: -370.0,
    q2_2023: -429.44,
    dollarDifference: -40.45,
    differencePercent: 10.2,
    group: "profit",
    level: 0,
    expanded: true,
  },
];

// Averra Oy data
export const WOLT_DATA: FinancialRow[] = [
  {
    financialRow: "Revenue",
    q1_2024: 456.78,
    q2_2024: 523.45,
    dollarDifference: 66.67,
    differencePercent: 14.6,
    group: "revenue",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Bazaar GOV",
    q1_2024: 3256.89,
    q2_2024: 3745.23,
    dollarDifference: 488.34,
    differencePercent: 15.0,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Consumer fees",
    q1_2024: 456.78,
    q2_2024: 523.45,
    dollarDifference: 66.67,
    differencePercent: 14.6,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Merchant fees",
    q1_2024: 312.45,
    q2_2024: 358.92,
    dollarDifference: 46.47,
    differencePercent: 14.9,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Other revenue",
    q1_2024: 23.45,
    q2_2024: 27.89,
    dollarDifference: 4.44,
    differencePercent: 18.9,
    group: "revenue",
    level: 1,
  },
  {
    financialRow: "Cost of revenue",
    q1_2024: 198.34,
    q2_2024: 227.89,
    dollarDifference: 29.55,
    differencePercent: 14.9,
    group: "costs",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Delivery and fulfillment",
    q1_2024: 156.78,
    q2_2024: 179.45,
    dollarDifference: 22.67,
    differencePercent: 14.5,
    group: "costs",
    level: 1,
  },
  {
    financialRow: "Payment processing",
    q1_2024: 28.45,
    q2_2024: 32.67,
    dollarDifference: 4.22,
    differencePercent: 14.8,
    group: "costs",
    level: 1,
  },
  {
    financialRow: "Other cost of revenue",
    q1_2024: 13.11,
    q2_2024: 15.77,
    dollarDifference: 2.66,
    differencePercent: 20.3,
    group: "costs",
    level: 1,
  },
  {
    financialRow: "Gross profit",
    q1_2024: 258.44,
    q2_2024: 295.56,
    dollarDifference: 37.12,
    differencePercent: 14.4,
    group: "profit",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Operating expenses",
    q1_2024: 345.67,
    q2_2024: 389.23,
    dollarDifference: 43.56,
    differencePercent: 12.6,
    group: "expenses",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Sales and marketing",
    q1_2024: 145.23,
    q2_2024: 167.89,
    dollarDifference: 22.66,
    differencePercent: 15.6,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Product development",
    q1_2024: 87.45,
    q2_2024: 98.34,
    dollarDifference: 10.89,
    differencePercent: 12.5,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "General and administrative",
    q1_2024: 67.89,
    q2_2024: 76.45,
    dollarDifference: 8.56,
    differencePercent: 12.6,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Depreciation and amortization",
    q1_2024: 45.1,
    q2_2024: 46.55,
    dollarDifference: 1.45,
    differencePercent: 3.2,
    group: "expenses",
    level: 1,
  },
  {
    financialRow: "Operating loss",
    q1_2024: -87.23,
    q2_2024: -93.67,
    dollarDifference: -6.44,
    differencePercent: 7.4,
    group: "profit",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Other income (expense), net",
    q1_2024: 8.45,
    q2_2024: 9.67,
    dollarDifference: 1.22,
    differencePercent: 14.4,
    group: "other",
    level: 0,
    expanded: true,
  },
  {
    financialRow: "Interest income",
    q1_2024: 6.78,
    q2_2024: 7.89,
    dollarDifference: 1.11,
    differencePercent: 16.4,
    group: "other",
    level: 1,
  },
  {
    financialRow: "Interest expense",
    q1_2024: -2.34,
    q2_2024: -2.67,
    dollarDifference: -0.33,
    differencePercent: 14.1,
    group: "other",
    level: 1,
  },
  {
    financialRow: "Other, net",
    q1_2024: 4.01,
    q2_2024: 4.45,
    dollarDifference: 0.44,
    differencePercent: 11.0,
    group: "other",
    level: 1,
  },
  {
    financialRow: "Net loss",
    q1_2024: -78.78,
    q2_2024: -84.0,
    dollarDifference: -5.22,
    differencePercent: 6.6,
    group: "profit",
    level: 0,
    expanded: true,
  },
];

// Generate period structure (FY 2014 to FY 2032)
const generatePeriodStructure = (): PeriodNode[] => {
  const years: PeriodNode[] = [];
  const months = [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ];

  for (let year = 2014; year <= 2032; year++) {
    const quarters: PeriodNode[] = [];
    for (let q = 1; q <= 4; q++) {
      const quarterMonths: PeriodNode[] = [];
      for (let m = (q - 1) * 3; m < q * 3; m++) {
        quarterMonths.push({
          id: `${year}-${m + 1}`,
          label: `${months[m]} ${year}`,
          type: "month",
          year,
          quarter: q,
          month: m + 1,
        });
      }
      quarters.push({
        id: `Q${q}-${year}`,
        label: `Q${q} ${year}`,
        type: "quarter",
        year,
        quarter: q,
        children: quarterMonths,
      });
    }
    years.push({
      id: `FY-${year}`,
      label: `FY ${year}`,
      type: "year",
      year,
      children: quarters,
    });
  }
  return years;
};

export const PERIOD_STRUCTURE = generatePeriodStructure();

// Subsidiary structure
export const SUBSIDIARY_STRUCTURE: SubsidiaryNode[] = [
  {
    id: "betaFoods-consolidated",
    label: "BetaFoods Consolidated (Incl. Averra)",
    children: [
      {
        id: "betaFoods-inc",
        label: "BetaFoods, Inc. (Consolidated)",
      },
      {
        id: "averra-oy",
        label: "Averra Oy (Consolidated)",
      },
    ],
  },
  {
    id: "LuxBite-inc",
    label: "LuxBite, Inc. (Consolidated)",
  },
];

// Helper to get all leaf nodes (selectable items)
export const getLeafNodes = (
  nodes: PeriodNode[] | SubsidiaryNode[],
  type: "period" | "subsidiary"
): string[] => {
  const leaves: string[] = [];
  nodes.forEach((node) => {
    if (!node.children || node.children.length === 0) {
      leaves.push(type === "period" ? (node as PeriodNode).label : (node as SubsidiaryNode).label);
    } else {
      leaves.push(...getLeafNodes(node.children, type));
    }
  });
  return leaves;
};

// Helper function to map period (month/quarter/year) to field name
export const getPeriodField = (period: string): string => {
  // Parse quarter format: "Q1 2024" -> "q1_2024"
  const quarterMatch = period.match(/Q(\d)\s+(\d{4})/);
  if (quarterMatch) {
    const [, quarter, year] = quarterMatch;
    return `q${quarter}_${year}`;
  }

  // Parse month format: "Jan 2024" -> "q1_2024" (map to quarter)
  const monthMatch = period.match(
    /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+(\d{4})/
  );
  if (monthMatch) {
    const [, month, year] = monthMatch;
    const monthToQuarter: { [key: string]: string } = {
      Jan: "1",
      Feb: "1",
      Mar: "1",
      Apr: "2",
      May: "2",
      Jun: "2",
      Jul: "3",
      Aug: "3",
      Sep: "3",
      Oct: "4",
      Nov: "4",
      Dec: "4",
    };
    const quarter = monthToQuarter[month] || "4";
    return `q${quarter}_${year}`;
  }

  // Parse year format: "FY 2024" -> "q4_2024" (map to Q4)
  const yearMatch = period.match(/FY\s+(\d{4})/);
  if (yearMatch) {
    const [, year] = yearMatch;
    return `q4_${year}`;
  }

  return "";
};
